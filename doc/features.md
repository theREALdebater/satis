# Feature Files

The unit tests generated by SATIS are primarily specified in _feature files_. 

A feature file is a plain text file---see [Text Files](text.md)--- written in the Markdown with
Gherkin language, or _MDG_.

.....

An MDG file is expected to have the `.feature.md` extension at the end of its name. 

.....



-----------------------------------------------------------------------------------------------
## Keywords






-----------------------------------------------------------------------------------------------
## Feature Section

A feature file should begin with a _feature section_. There should only be one feature section 
in a feature file (and it should be the first section). 

The feature section represents a _feature_ of the body of software under test. What constitutes 
a feature is not precisely defined, and does not need to be. It is a way of grouping a part of 
the software, and therefore the associated set of tests. The idea is that each feature is 
relatively independent of most other features. 

The feature section is followed by: 

 * optionally, one or more [background sections](#background-sections), each being followed by
   the sections it may be followed by; or 
 
 * optionally, one or more [rule sections](#rule-section), each being followed by the sections
   it may be followed by; or 
 
 * one or more [scenario sections](#scenario-sections).

.....

For example:

    # Feature: Flight Booking System Core
    
    .....



-----------------------------------------------------------------------------------------------
## Rule Section

A _rule section_ establishes a grouping of scenarios within a background section, or within a 
feature section (file) if there are no background sections. 

The intention of a rule section is to state a 'business rule' that the following (two or more) 
scenarios relate to. 

A 'business rule' isn't necessarily to do with business; it would be less confusing to use the 
term 'application rule'. It is a rule that operates, and can be understood, at the level of the 
application. The 'application' is the problem that the body of software is aimed at solving, or 
the real-world process (or set of processes) that it is assisting. 

......

A rule section is followed by: 

 * optionally, one [background section](#background-sections), which is itself followed by the
   sections it may be followed by; or 
 
 * one or more [scenario sections](#scenario-sections).

......

A rule section must have either: 

 * a background section immediately following it; or 
 
 * at least one one scenario associated with it. 

Any scenario sections following a rule section `R` (that has no background section), but with 
no other rule section in between, is associated with rule section `R`. 

.....



-----------------------------------------------------------------------------------------------
## Background Sections

A _background section_ establishes preconditions that are to implicitly apply to all the
[scenarios](#scenario-sections) that follow it (until either the next rule section or the end
of the feature file). 

.....

The background section can have a title and arbitrary text, like all sections, and it can have 
one or more steps. The steps must be preconditions: the first one must start with the keyword 
`given` or `when` and subsequent steps must must start with the keyword `given`, `when`, `and`, 
or `or`. 

A background section is followed by: 

 * one or more [scenario sections](#scenario-sections).
   
Any scenario sections following a background section, but with no rule section in between, is 
associated with that background section. 

A background section must have at least one step, and it must have at least one scenario 
associated with it. 

For every scenario associated with a background section, the preconditions of the background 
section

.....

For example:

    ## Background
    
    * Given .....
    * And .....

.....



-----------------------------------------------------------------------------------------------
## Scenario Sections

A _scenario section_ 

A _scenario template_ is a scenario section which has one or more _placeholders_ within its
steps. There will be two or more _instances_ of the template; each instance will supply a value
for each placeholder. Each instance, after the placeholders have been replaced, therefore
represents a scenario. 

A scenario section begins with the keyword `scenario` or `example`. If this keyword is followed 
by either the keyword `outline` or `template`, then the section is a scenario template, 
otherwise it is a scenario. These keywords are then followed by the title of the scenario 
(template). 

.....




..... contains [steps](#steps):

 * one or more _precondition steps_;
 
 * one or more _expectation step_.



For a scenario or a scenario template, there should be a corresponding scenario section in a
[SATIS file](syntax.md) with a matching title. The steps associated with the scenario section
in a feature file are the only steps which can match step declarations (q.v.) in the setup,
tear-down, and tests associated with the corresponding scenario section in the SATIS file. 

It is recommended that documentation specific to the implementation of the steps is placed in
the SATIS file, but that other documentation (e.g. a description of the scenario, the purpose
and meaning of the steps, any further information as to how the steps relate to the subject
under test) are placed in the feature file. 



-----------------------------------------------------------------------------------------------
## Tags

One or more _tags_ can be applied to a feature, rule, or scenario section in a feature file, by 
placing it with an at-the-cost-of `@` symbol before it, and between back quote characters, on 
the line immediately before the feature, rule, or scenario header. 

For example:

    `@smoke-tests` `@essentials`
    ## Scenario: Basics
    
    ...
    
A tag applied to a scenario is treated by SATIS as a [category](categories.md) name. A tag
applied to a feature or a rule applies to all the scenarios of that feature or rule. 

In the above example, the scenario `Basics` will be put into in the categories `smoke-tests` 
and `essentials`. 

The same name matching rules are used. So, for example, `basics` matches `Basics`, and 
`smoke-tests` matches `Smoke Tests`. 



-----------------------------------------------------------------------------------------------
## Steps

.....





### Placeholders

Within a scenario template, a _placeholder_ is a name, within steps, that represents a value 
which is to be supplied later. Placeholders are distinguished by being surrounded by `<` and 
`>` angle brackets. 

If a placeholder occurs in multiple places (in the same or in different steps in the same 
scenario), it will be replaced by the same value in any one instance. 

For example:

     * Given we try to book a party of <n> passengers onto flight <f>

In this step, the `<n>` and `<f>` are both placeholders. 

A scenario is permitted to have a [payload area](text.md#payload-areas). If it does, it is
passed into matched tests as the component named `Payload` of the test representative. 

As another example:

     * Given flight <f> has <n1> spare seats

     * When I book the flight

     * Then flight <f> should have <n2> spare seats

In this example, the placeholder `<f>` occurs in two steps. In any one instance of the scenario 
template, this placeholder will be replaced by the same value in both places. 

To illustrate this, it would be as if, for any instance which replaced `<f>` with `AB123XY89` 
(and which replaced `<n1>` with `120` and `<n2>` with `115`) we had put a scenario with: 

     * Given flight AB123XY89 has 120 spare seats

     * When I book the flight

     * Then flight AB123XY89 should have 115 spare seats


### Scenario Conventions

By convention, there is usually, within a scenario:

 1. one precondition step beginning with the word `Given`; followed by 
 
 2. optionally, one or more further precondition steps beginning with the word `And` or `But`; 
    followed by 
    
 3. one precondition step beginning with the word `When`; followed by 
 
 4. one expectation step beginning with the word `Then`; followed by 
 
 5. optionally, one or more further expectation steps beginning with the word `And` or `But`. 

The precondition beginning with `When` is intended to be the key triggering event of the 
scenario.

However, this is only a convention, and does not affect how SATIS works. 

Besides ensuring that the feature file and associated [SATIS files](syntax.md) are working
together to perform the appropriate testing, what matters is that the (steps in the) feature
file express the testing in a way that is as intelligible and unambiguous to people as
possible. 

SATIS adds a new kind of step, called the [calculation step](calculations.md) that is not
supported by other Gherkin-based tool systems. 





Each step is matched by one or more items in a [SATIS file](syntax.md) .....









### Precondition Steps

The keywords `given` and `when` begin a _precondition step_ .....

.....

Any subsequent step beginning with the keyword `and` or `but` also begins a precondition step 
until the end of the steps or a step that does not begin with the keyword `and` or `but`. 





### Expectation Steps

The keyword `then` begins an _expectation step_ .....

.....

Any subsequent step beginning with the keyword `and` or `but` also begins an expectation step 
until the end of the steps or a step that does not begin with the keyword `and` or `but`. 


### Calculation Steps

The keyword `where` begins a _calculation step_ .....

The `where` must be followed by the name of a placeholder (between angle brackets) and then the
keyword `is` and then the matchable part of the step. 

.....

Any subsequent step beginning with the keyword `and` or `but` also begins a calculation step 
until the end of the steps or a step that does not begin with the keyword `and` or `but`. 

The purpose of a calculation step is to calculate the value of a placeholder from the values of
other placeholders. A placeholder whose value is calculated is termed a
_calculated placeholder_ and so, conversely, a placeholder whose value is not calculated is a
_non-calculated placeholder_. 

Calculation steps are not a standard part of Gherkin (or MDG), but are an extension exclusive
to SATIS. You cannot use them if you need to ensure your MDG feature files are compatible with
processing tools other than SATIS. 


### Data Table

A scenario template section may contain one or more _data tables_. The data table provides the 
values for each non-calculated placeholder for all the instances of the scenario. 

The data table must use the usual Markdown format for a table, but every line must be indented 
by two spaces. 

There must be a header row. In each column of the header row, the header must match the name of
a non-calculated placeholder (not in angle brackets). There must be a column for every
non-calculated placeholder. There will be one data row per instance. In the data rows, each
cell must contain the value that is to replace the placeholder for that instance.

If a scenario template section does not have any data table, then any matching test must have 
at least one associated test data section. 


### Examples

    ### Scenario template: Booking a passenger uses up one seat

     * Given we try to book a party of <n> passengers onto flight <f>

     * And flight <f> has <n1> spare seats

     * When I book the flight

     * Then flight <f> should have <n2> spare seats

     * Where <n2> is <n1> minus <n>
     
    #### Examples

      | f         | n     | n1    |
      | --------- | ----- | ----- |
      | AB123XY89 | 5     | 120   |
      | AB123XY89 | 10    | 120   |

In this example, the heading .....

