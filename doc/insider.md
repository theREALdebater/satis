# Insider Testing

Generally, unit tests of the subprograms of a package are written in terms of the public 
operations of that package, the subprograms which are declared in the visible part of the 
package. 

All the unit tests generated by SATIS are normally placed within the package `SATIS.Tests`. 
They have visibility of the public operations of (public) packages. However, sometimes it is 
necessary or desirable to test the subprograms which are private to a package---those which 
are declared in the package's private part or body---and so SATIS provides a mechanism to do 
so, called _insider testing_. 

To write tests that can use things that are private to a package, which is called the
_subject package_, there are a few steps you need to take.

You need to insert the following into the visible part of the subject package's specification: 

```ada
   procedure Self_Test (Test: in out SATIS.Test_Context'Class);
```

You also need to insert the following into the subject package's body, at the end (but before 
the `begin` if there is one): 

```ada
   procedure Self_Test (Test: in out SATIS.Test_Context'Class) is separate;
```

Supposing your subject package is named `Kwikair.Aircraft.Seat_Layout`, for example, you need 
to add a scenario declaration like the following: 

```
 * Inside package: Kwikair.Aircraft.Seat_Layout
```

If you want to use a different name to `Self_Test`, let's say you want to use 
`Verify_Software`, you can also add the declaration: 

```
 * Testing procedure: Verify_Software
```

Supposing the scenario ends up being numbered 234, SATIS will then generate the following 
wrapper procedure to run the scenario: 

```ada
with Kwikair.Aircraft.Seat_Layout.Self_Test;
procedure SATIS.Tests.Run_Test_Scenario_234 (Test: in out SATIS.Test_Context'Class)
is
   Kwikair.Aircraft.Seat_Layout.Self_Test (Test);
end;
```

SATIS will generate a procedure such as the following: 

```ada
with SATIS;
with ...;
separate (Kwikair.Aircraft.Seat_Layout)
procedure Self_Test (Test: in out SATIS.Test_Context'Class)
is
   ...
end Self_Test;
```

This procedure contains all the actual test code for the scenario, and is able to access 
everything private to the subject package (`Kwikair.Aircraft.Seat_Layout`). 

Note that this means all the test code (including scenario setup and tear-down) is now in the 
context of being inside the subject package's body, rather than being inside the body of the 
package `SATIS.Tests` as normal. 

If you need to reference something inside the `SATIS` package, you must prefix it with 
`SATIS.` or be in the scope of a `use SATIS;` declaration. 

On the other hand, you can directly reference entities declared in the subject package's 
private part or body, without having to prefix them. 

......








